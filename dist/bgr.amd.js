define(["node-fetch","@turf/turf"],(function(e,t){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var r=require("./lib/DomParser");module.exports=r;var n=Object.freeze({__proto__:null});const o="No information available for given query";var a={createBBox:e=>t.bbox(t.toMercator(t.buffer(e,.01,{units:"kilometers"}))).join("%2C"),sqrHtmlParsing(e){const t=(new n).parseFromString(e,"text/html");return 4==t.getElementsByTagName("td").length?t.getElementsByTagName("td")[3]?Number(t.getElementsByTagName("td")[3].innerHTML):o:t.getElementsByTagName("td")[1]?Number(t.getElementsByTagName("td")[1].innerHTML):o},soilTypeHtmlParsing(e,t){const r=(new n).parseFromString(e,"text/html");return r.getElementsByTagName("td")[t]?r.getElementsByTagName("td")[t].innerHTML:o},async request(t){const r=await e(t);return await r.text()},createGeometry(e){if("[object Array]"!==Object.prototype.toString.call(e)){if("object"==typeof e){if("Point"===e.type&&2===e.coordinates.length)return e;if("Feature"===e.type||"Polygon"===e.type)return t.centroid(e);throw new Error("Invalid GeoJSON")}throw new Error("BGR function expected array of point coordinates, or a valid GeoJSON feature object. Received string instead.")}if(2===e.length)return{type:"Point",coordinates:e}}};return{async soilType(e){if(!e)throw new Error("Invalid point passed to soilType function");const t=a.createGeometry(e),r=await a.request(`https://services.bgr.de/wms/boden/boart1000ob/?&REQUEST=GetFeatureInfo&SERVICE=WMS&CRS=EPSG%3A3857&STYLES=default&TRANSPARENT=true&VERSION=1.3.0&FORMAT=image%2Fpng&BBOX=${a.createBBox(t)}&HEIGHT=880&WIDTH=514&LAYERS=0&QUERY_LAYERS=0&INFO_FORMAT=text%2Fhtml&I=452&J=371`);return a.soilTypeHtmlParsing(r,5)},async humusContent(e){if(!e)throw new Error("Invalid point passed to soilType function");const t=a.createGeometry(e),r=await a.request(`https://services.bgr.de/wms/boden/humus1000ob/?&REQUEST=GetFeatureInfo&SERVICE=WMS&CRS=EPSG%3A3857&STYLES=default&TRANSPARENT=true&VERSION=1.3.0&FORMAT=image%2Fpng&BBOX=${a.createBBox(t)}&HEIGHT=880&WIDTH=514&LAYERS=0&QUERY_LAYERS=0&INFO_FORMAT=text%2Fhtml&I=452&J=371`);return a.soilTypeHtmlParsing(r,3)},async sqr(e,t){if(!e)throw new Error("Invalid point passed to soilType function");t||(t=32);const r=a.createGeometry(e),n=await a.request(`https://services.bgr.de/wms/boden/sqr1000/?&REQUEST=GetFeatureInfo&SERVICE=WMS&CRS=EPSG%3A3857&STYLES=default&TRANSPARENT=true&VERSION=1.3.0&FORMAT=image%2Fpng&BBOX=${a.createBBox(r)}&HEIGHT=830&WIDTH=561&LAYERS=${t}&QUERY_LAYERS=${t}&INFO_FORMAT=text%2Fhtml`);return a.sqrHtmlParsing(n)}}}));
